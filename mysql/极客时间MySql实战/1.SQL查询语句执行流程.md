## 简单的执行流程分析
![查询语句执行流程](./img/Mysql%20查询语句执行流程.jpg)
### 连接器
```
提供客户端和服务器的连接和身份验证

1.tcp 三次握手建立连接
2.身份验证
  1.用户和密码验证
  2.到权限表里面去获取权限数据.并保存到内存里面。
      (管理员对用户设置权限之后,不会影响已经存在的连接,需要等到下一次建议网络连接重新读取权限表才会生效)



note:
若建立完连接不操作数据库该链接就会变成sleep状态

sleep 状态会持续8个小时自动断开连接。(wait_timeout 参数可修改)


建立长连接造成MySQL内存长的过快:
  mysql建立连接后执行时使用的临时内存都是使用的管理在连接对象里面的。只有断开连接才会释放内存
  
  解决方法：
    1.一段时间断开连接,需要操作数据库在重新连接
    2.大于等于MySQL5.7 版本 ,可以在每次执行一个比较大的操作后，通过执行 mysql_reset_connection来重新初始化连接资源,这个过程不需要重新做权限验证。
```

## 查询缓存
```
1.查询缓存书否存在对用的数据

  查询到数据权限通过 直接返回数据
  未查询到数据到分析器继续执行


在大多数情况下不建议使用缓存去缓存数据
  1.表数据更新频繁的表(因为缓存数据频繁的过期)
     
当存在一张全局静态表的时候(不频繁修改数据的表) 


小于MySQL8.0版本 配置 query_cache_type=DEMAND,将查询缓存配置成按需缓存
只有 select SQL_CACHE .......   显示指定的时候才允许将查询出来的数据进行缓存


MySQL 8.0版本直接将查询缓存的整块功能删掉了，也就是说8.0开始彻底没有这个功能了。
```


## 分析器
```
1.词法分析
   select SQL_CACHE * from T where ID=10；
   
   [select,*,SQL_CACHE,from,T,where,ID=10]

  多条字符串通过空格进行拆分 识别关键字
  select 查询语句 ID 查询ID列 

2.语法分析
  根据词法分析结果,判断MySQL 语法的正确性。
```

## 优化器
```
根据分析其MySQL 已经知道这条sql语句的功能

优化器通过判断进行优化
```

## 执行器
```sql
select * from T where ID=10;
1.判断该用户是否具有执行该表的权限

2.执行器根据该表定义的存储引擎去使用引擎提供的接口去查找
    


    调用InnoDB引擎接口取这个表的第一行，判断ID值是不是10，如果不是则跳过，如果是则将这行存在结果集中；

    调用引擎接口取“下一行”，重复相同的判断逻辑，直到取到这个表的最后一行。

    执行器将上述遍历过程中所有满足条件的行组成的记录集作为结果集返回给客户端。
    
```